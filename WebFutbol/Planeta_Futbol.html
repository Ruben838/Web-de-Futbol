<html>

<head>
  <link rel="stylesheet" href="Planeta_Futbol.css">
  <h1>Planeta futbol</h1>
</head>

<body>

  <nav class="menu">
    <ul>
      <li><a href="#equipos">Equipos</a></li>
      <li><a href="#clasificacion">Clasificacion</a></li>
      <li><a href="#resultados">Resultados</a></li>
      <li><a href="#jugador">Jugadores Destacados</a></li>
      <li><a href="#jugadoresPorEquipo">Jugadores de cada equipo</a></li> <!-- Nueva sección en el menú -->
    </ul>
  </nav>

  <div id="equipos" class="dissenyequips">
    <h2 style="font-size: 3em;">Equipos de la Premiere League</h2>
    <div id="equipos-list"></div>
    <table id="equipos-list">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Escudo</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="clasificacion" class="dissenyclasificacio">
    <h2 style="font-size: 3em;">Clasificacion</h2>
    <table id="clasificacion-list">
      <thead>
        <tr>
          <th>Posicion</th>
          <th>Equipo</th>
          <th>Puntos</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <div id="resultados" class="dissenyresultat">
    <h2 style="font-size: 3em;">Resultados Recientes</h2>
    <div id="resultados-list"></div>
  </div>

  <div id="jugador" class="dissenyjugador">
    <h2 style="font-size: 3em;">Jugadores Destacados</h2>
    <div id="jugadores-list"></div>
    <table id="jugadores-list">
      <thead>
        <tr>
          <th>Goles</th>
          <th>Nombre</th>
          <th>Equipos</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <!-- Nueva sección para Jugadores de cada equipo -->
  <div id="jugadoresPorEquipo" class="dissenyclasificacio">
    <h2 style="font-size: 3em;">Jugadores de cada equipo</h2>
    <table id="jugadores-list-equipos">
      <thead>
        <tr>
          <th>Equipo</th>
          <th>Jugadores</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <script>
    const baseUrl = "https://api.football-data.org/v4";
    const apiKey = "10604bd89e244729bd887299f18c6308";

    function fetchData(endpoint, callback) {
      $.ajax({
        url: `${baseUrl}${endpoint}`,
        headers: { "X-Auth-Token": apiKey },
        success: callback,
        error: function (error) {
          console.log("Error al obtener datos: ", error);
        }
      });
    }

    function fetchTeams() {
      fetchData("/competitions/PL/teams", function (data) {
        const teamsDiv = $("#equipos-list tbody");
        teamsDiv.empty();
        data.teams.forEach(function (team) {

          teamsDiv.append(`
          <tr>
              <td>${team.name}</td>
              <td> <img src= "${team.crest}"/> </td>
              
            </tr>
          `);
        });
      });
    }

    function fetchStandings() {
      fetchData("/competitions/PL/standings", function (data) {
        const standingsTable = $("#clasificacion-list tbody");
        standingsTable.empty();
        data.standings[0].table.forEach(function (team) {
          standingsTable.append(`
            <tr>
              <td>${team.position}</td>
              <td>${team.team.name}</td>
              <td>${team.points}</td>
            </tr>
          `);
        });
      });
    }

    function fetchResults() {
      fetchData("/competitions/PL", function (seasonData) {
        const currentMatchday = seasonData.currentSeason.currentMatchday - 1;
        fetchData("/competitions/PL/matches?matchday="+currentMatchday, function (data) {
          const resultsDiv = $("#resultados-list");
          resultsDiv.empty();
          data.matches.forEach(function (match) {
            resultsDiv.append(`<p>${match.homeTeam.name} ${match.score.fullTime.home} - ${match.score.fullTime.away} ${match.awayTeam.name}</p>`);
          });
        });
      });
    }

    function fetchPlayers() {
      fetchData("/competitions/PL/scorers", function (data) {
        const scoreDiv = $("#jugadores-list tbody");
        scoreDiv.empty();
        data.scorers.forEach(function (scorer) {
          scoreDiv.append(` 
        <tr>
              <td>${scorer.goals}</td>
              <td>${scorer.player.name}</td>
              <td>${scorer.team.name}</td>
            </tr>`);
        });

      });
    }
    function fetchPlayersByTeam() {
      fetchData("/competitions/PL/teams", function (data) {
        const teamsDiv = $("#jugadores-list-equipos tbody");
        teamsDiv.empty();
        data.teams.forEach(function (team) {
          fetchData(`/teams/${team.id}`, function (teamData) {
            let playersList = teamData.squad
              .map(player => player.name)
              .join(", ");

            teamsDiv.append(`
              <tr>
                <td>${team.name}</td>
                <td>${playersList}</td>
              </tr>
            `);
          });
        });
      });
    }

    $(document).ready(function () {
      fetchTeams();
      fetchStandings();
      fetchResults();
      fetchPlayers();
      fetchPlayersByTeam();
    });
  </script>

</body>

</html>